name: Doc-Pilot
on: push

permissions: 
    actions: read
    contents: write

jobs:
    add-docstring:
        runs-on: ubuntu-latest
        steps:
          - uses: actions/checkout@v2
            with:
              path: DocPilot
              persist-credentials: false
              submodules: "recursive"
              fetch-depth: 10

              
        
          - name: Fetch Commit Changes
            id: fetch_changes
            env:
              GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
            run: |
              COMMIT_HASH=$(git log -1 --pretty=format:"%H")
              OWNER=${{ github.repository_owner }}
              REPO=${{ github.repository }}
              API_URL="https://api.github.com/repos/$OWNER/$REPO/commits/$COMMIT_HASH"
      
              # Fetch commit data including changes
              COMMIT_DATA=$(curl -s -H "Authorization: token $GITHUB_TOKEN" -X GET $API_URL)
              CHANGES_URL=$(echo "$COMMIT_DATA" | jq -r '.files_url')
      
              # Fetch the detailed changes
              CHANGES_DATA=$(curl -s -H "Authorization: token $GITHUB_TOKEN" -X GET $CHANGES_URL)
              echo "::set-output name=commit_changes::$(echo "$CHANGES_DATA" | jq -r '.[] | .filename, .additions, .deletions, .changes')"
      
            shell: bash
      
          - name: Display Commit Changes
            run: |
              commit_changes="${{ steps.fetch_changes.outputs.commit_changes }}"
              echo "$commit_changes"
            shell: bash
      



