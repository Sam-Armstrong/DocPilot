name: Doc-Pilot
on: [push, pull_request, workflow_dispatch, workflow_call]

permissions: 
    contents: write

jobs:
    add-docstring:
        runs-on: ubuntu-latest
        steps:
        - name: Checkout üõéÔ∏è ${{ github.event.repository.name }}
          uses: actions/checkout@v4
          with:
            path: DoCPilot
            persist-credentials: false
            submodules: "recursive"
            set-safe-directory: false

        - name: Install dependencies
          run: |
              sudo apt-get install -y git diffutils
      
        - name: Get changed files
          id: changed-files
          run: |
              git diff --name-only ${{ github.event.before }} ${{ github.sha }} | tee changed_files.txt
      
        - name: Get lines of code changed
          id: loc
          run: |
            loc=$(git diff ${{ github.event.before }} ${{ github.sha }} --numstat | awk '{s+=$1} END {print s}')
            echo "::set-env name=LINES_OF_CODE::$loc"
      
        - name: Print outputs  
          run: |
              echo "Changed files:"
              cat changed_files.txt
              echo "${{ env.LINES_OF_CODE}} lines of code changed"
        
        - name: Run Claude Script
          run: |
            echo "claude magic"
        
        - name: Cleanup Process
          run: |
            echo "We have now run cleanup"

